<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Open Education API documentation</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Open Education API documentation" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Docsify theme -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple.css">

  <!-- Docsify versioned plugin styles -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/docsify-versioned-plugin@0.0.1/styles.css">

  <!-- OOAPI custom theme (absolute: shared for all versions) -->
  <link rel="stylesheet" href="/theme.css">
</head>

<body>
  <!-- banner injected by ooapi-versioning.js -->
  <div id="version-banner"></div>

  <!-- docsify mount -->
  <div id="app"></div>

  <script>
    function detectVersionFromPath() {
      const parts = location.pathname.split('/').filter(Boolean);
      const first = parts[0];
      return /^v\d+\.\d+$/.test(first) ? first : null;
    }

    async function loadVersions() {
      const response = await fetch('/versions.json', { cache: 'no-store' });
      return response.json();
    }

    (async () => {
      const cfg = await loadVersions();
      const current = cfg.current;
      const active = detectVersionFromPath();

      // Root landing â†’ current
      if (!active) {
        location.replace('/' + current + '/');
        return;
      }

      // Convert to docsify-versioned-plugin format
      const versions = cfg.versions.map(v => ({
        folder: v.id,
        label: v.label || v.id,
        default: v.id === current
      }));

      // Make version info globally available (for banner logic)
      window.__OOAPI_VERSION_INFO__ = {
        active,
        meta: cfg.versions.find(v => v.id === active) || null,
        current: cfg.current,
        beta: cfg.beta || null
      };

      window.$docsify = {
        name: 'Open Education API ' + active.toUpperCase(),
        repo: 'https://github.com/open-education-api/specification',

        homepage: 'home.md',
        basePath: '',

        loadSidebar: true,
        alias: {
          '/.*/_sidebar.md': '/_sidebar.md'
        },

        subMaxLevel: 0,
        maxLevel: 1,

        search: 'auto',
        externalLinkTarget: '_self',

        logo: '_media/OpenEducationApi_Logo.png',

        versions,
        versionSelectorLabel: 'Version',

        tabs: {
          persist: true,
          sync: true,
          theme: 'classic',
          tabComments: true,
          tabHeadings: true
        }
      };
    })();
  </script>

  <!-- Docsify core -->
  <script src="https://cdn.jsdelivr.net/npm/docsify@4"></script>

  <!-- Plugins -->
  <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/docsify-sidebar-collapse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/js/docsify-themeable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify-tabs@1"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/front-matter.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"></script>

  <!-- Version selector -->
  <script src="https://cdn.jsdelivr.net/npm/docsify-versioned-plugin@0.0.1/index.js"></script>

  <!-- OOAPI banner + extras (absolute, shared) -->
  <script src="/ooapi-versioning.js"></script>
</body>
</html>
